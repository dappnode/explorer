(this["webpackJsonpdappnode-explorer"]=this["webpackJsonpdappnode-explorer"]||[]).push([[0],{223:function(e,t,n){e.exports=n(428)},228:function(e,t,n){},229:function(e,t,n){},230:function(e,t,n){},412:function(e,t,n){},415:function(e,t,n){},416:function(e,t,n){},418:function(e,t,n){},419:function(e,t,n){},425:function(e,t,n){},426:function(e,t,n){},427:function(e,t,n){},428:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n.n(a),c=n(79),s=n.n(c),i=n(40),l=n(194),o=n(10),m=n(433),u=(n(228),n(229),n(35));n(230);function d(){return r.a.createElement("div",{className:"app-header"},r.a.createElement("div",{className:"app-container"},r.a.createElement(i.b,{to:"/"},r.a.createElement("h1",null,r.a.createElement("span",{className:"dappnode"},"DAppNode"),r.a.createElement("span",{className:"explorer"},"EXPLORER")))))}var p=n(37);n(412);function v(e){return r.a.createElement("span",{style:{color:"#767e86",fontSize:12.8}},e)}function f(e){var t=e.active,n=e.payload,a=void 0===n?[]:n,c=e.label;return t&&a?r.a.createElement("div",{className:"custom-recharts-tooltip"},r.a.createElement("div",null,c),r.a.createElement("table",null,r.a.createElement("tbody",null,a.reverse().map((function(e){var t=e.name,n=e.color,a=e.value;return r.a.createElement("tr",{key:t,style:{color:n}},r.a.createElement("td",null,a),r.a.createElement("td",null,t))}))))):null}function E(e){var t=new Date(new Date("2020/".concat(e+1,"/1")).getTime());return new Intl.DateTimeFormat("en-US",{month:"short"}).format(t)}function h(e){var t=function(e){return e?e.versions.map((function(t,n){return{month:E(t.month),versions:(e.versions[n]||{}).count||0,packages:(e.packages[n]||{}).count||0}})):[]}(e.activity);return r.a.createElement("div",{className:"activity-chart"},r.a.createElement("div",{className:"header"},r.a.createElement("div",{className:"time"},"LAST 12 MONTHS"),r.a.createElement("div",{className:"name"},"ACTIVITY")),r.a.createElement(p.d,{height:200},r.a.createElement(p.b,{data:t},r.a.createElement(p.f,{dataKey:"month",stroke:"#2c3034",tick:{fill:"#767e86",fontSize:12.8}}),r.a.createElement(p.e,{isAnimationActive:!1,cursor:{fill:"transparent"},content:f}),r.a.createElement(p.c,{formatter:v}),r.a.createElement(p.a,{isAnimationActive:!1,maxBarSize:20,dataKey:"packages",name:"new packages",stackId:"a",fill:"#bc7a2f"}),r.a.createElement(p.a,{isAnimationActive:!1,maxBarSize:20,dataKey:"versions",name:"new versions",stackId:"a",fill:"#2fbcb2"}))))}var g,b,y,N,x,k=n(188),w=n(84),j=n(20),C=n(66),V=n(41),O=n.n(V),A=(n(31),n(67),n(21));function I(){var e=Object(C.a)(["\n    query Activity {\n  versions(first: 1000) {\n    timestamp\n  }\n  repos(first: 1000) {\n    timestamp\n  }\n}\n    "]);return I=function(){return e},e}function H(){var e=Object(C.a)(["\n    query Count {\n  registries {\n    name\n    repoCount\n    versionCount\n  }\n}\n    "]);return H=function(){return e},e}function R(){var e=Object(C.a)(["\n    query Repo($id: ID!) {\n  repo(id: $id) {\n    id\n    name\n    registryName\n    timestamp\n    txHash\n    sender\n    versionCount\n    lastVersion {\n      index\n    }\n    versions {\n      index\n      semanticVersion\n      contentUri\n      timestamp\n      txHash\n      sender\n    }\n  }\n}\n    "]);return R=function(){return e},e}function S(){var e=Object(C.a)(["\n    query Repos {\n  repos(first: 1000) {\n    id\n    name\n    registryName\n    versionCount\n    lastVersion {\n      semanticVersion\n      contentUri\n      timestamp\n    }\n  }\n}\n    "]);return S=function(){return e},e}!function(e){e.Id="id",e.Hash="hash"}(g||(g={})),function(e){e.Asc="asc",e.Desc="desc"}(b||(b={})),function(e){e.Id="id",e.Address="address",e.Name="name",e.RepoCount="repoCount",e.VersionCount="versionCount",e.Repos="repos"}(y||(y={})),function(e){e.Id="id",e.Address="address",e.Name="name",e.Node="node",e.Timestamp="timestamp",e.TxHash="txHash",e.Sender="sender",e.LastVersion="lastVersion",e.VersionCount="versionCount",e.Versions="versions",e.Registry="registry",e.RegistryName="registryName",e.RegistryId="registryId"}(N||(N={})),function(e){e.Id="id",e.SemanticVersion="semanticVersion",e.CodeAddress="codeAddress",e.ContentUri="contentUri",e.Index="index",e.Timestamp="timestamp",e.TxHash="txHash",e.Sender="sender",e.RepoName="repoName",e.RepoAddress="repoAddress",e.RepoNamehash="repoNamehash",e.RegistryName="registryName"}(x||(x={}));var U=O()(S());var T=O()(R());var L=O()(H());var D=O()(I());n(415);function F(){var e,t=A.c(L,e).data,n=(null===t||void 0===t?void 0:t.registries)||[],a=n.reduce((function(e,t){return e+t.repoCount}),0),c=n.reduce((function(e,t){return e+t.versionCount}),0),s=[{title:"Published packages",stat:a,Icon:k.a},{title:"Published versions",stat:c,Icon:w.b}];return r.a.createElement("div",{className:"summary-stats"},s.map((function(e){var t=e.title,n=e.stat,a=e.Icon;return r.a.createElement("div",{key:t,className:"card"},r.a.createElement("span",{className:"title"},t),r.a.createElement("span",{className:"stat"},n),r.a.createElement("span",{className:"icon"},r.a.createElement(a,null)))})))}var B=n(25),q=r.a.createContext({ipfsGateway:"https://gateway.ipfs.dappnode.io",ipfsApi:"https://infura-ipfs.io:5001",txViewer:"https://etherscan.io/tx"}),z=(q.Provider,q.Consumer,q);function $(e){return e&&"string"===typeof e?e.charAt(0).toUpperCase()+e.slice(1):e}function G(e){return e.replace(/-/g," ").replace(/_/g," ").replace(/\./g," ").split(" ").map($).join(" ")}function P(e){return e.replace(/,/g,".")}function K(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.join("/").replace(/([^:]\/)\/+/g,"$1")}function Y(e){return e.replace(/\/*ipfs\/*$/,"").replace(/^\/*ipfs[/:]*/,"")}function J(e,t){return K(Y(e),"ipfs",Y(t))}var M=n(189),W=n.n(M);function _(e){var t=e.timestamp;if(!t)return r.a.createElement("div",null,"-");var n=W()(1e3*t);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,n.calendar()),r.a.createElement("div",{className:"light"},n.fromNow()))}n(416);function X(){var e,t=Object(a.useState)(20),n=Object(B.a)(t,2),c=n[0],s=n[1],i=Object(u.e)(),l=Object(a.useContext)(z).ipfsGateway,o=A.c(U,e);if(Object(a.useEffect)((function(){function e(){window.innerHeight+document.documentElement.scrollTop>.99*document.documentElement.offsetHeight&&s((function(e){return e+20}))}return o.data&&o.data.repos.length>c&&document.addEventListener("scroll",e),function(){document.removeEventListener("scroll",e)}}),[c,o.data]),o.data){var m=o.data.repos;return r.a.createElement("div",{className:"table-container"},r.a.createElement("table",{className:"summary-table"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{className:"logo"}),r.a.createElement("th",null,"Name"),r.a.createElement("th",null,"Last updated"),r.a.createElement("th",null,"Last version"),r.a.createElement("th",{className:"registry"},"Registry"))),r.a.createElement("tbody",null,m.sort((function(e,t){var n,a;return((null===(n=t.lastVersion)||void 0===n?void 0:n.timestamp)||0)-((null===(a=e.lastVersion)||void 0===a?void 0:a.timestamp)||0)})).slice(0,c).map((function(e){var t=e.id,n=e.name,a=e.registryName,c=e.versionCount,s=e.lastVersion;return r.a.createElement("tr",{key:t,onClick:function(){return i.push("/repo/".concat(t))}},r.a.createElement("td",{className:"logo"},s&&r.a.createElement("img",{src:K(l,s.contentUri,"avatar.png"),alt:"logo"})," "),r.a.createElement("td",null,r.a.createElement("div",null,G(n)),r.a.createElement("div",{className:"registry-under-name"},r.a.createElement(Q,{registry:a,small:!0}))),r.a.createElement("td",null,r.a.createElement(_,{timestamp:null===s||void 0===s?void 0:s.timestamp})),r.a.createElement("td",null,s?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,P(s.semanticVersion)),r.a.createElement("div",{className:"light"},c)):r.a.createElement("div",null,"-")),r.a.createElement("td",{className:"registry"},r.a.createElement(Q,{registry:a})))})))))}return o.error?r.a.createElement("div",null,o.error.message):o.loading?r.a.createElement("div",null,"Loading..."):null}function Q(e){var t=e.registry,n=e.small,a=function(e){return"dnp.dappnode.eth"===e?"dnp":"public.dappnode.eth"===e?"public":void 0}(t);return r.a.createElement("div",{className:"registry-badge ".concat(n?"small":"")},r.a.createElement("span",{className:a},a||t))}var Z=n(30);function ee(e){var t,n=function(e){return 12*e.getFullYear()+e.getMonth()},a={},r=Object(Z.a)(e);try{for(r.s();!(t=r.n()).done;){var c=t.value;if(c.timestamp){var s=n(new Date(1e3*c.timestamp));a[s]=(a[s]||0)+1}}}catch(m){r.e(m)}finally{r.f()}for(var i=n(new Date),l=[],o=i-11;o<=i;o++)l.push({month:o%12,count:a[o]||0});return l}function te(){var e,t,n,a=A.c(D,n),c=(null===(e=a.data)||void 0===e?void 0:e.versions)||[],s=(null===(t=a.data)||void 0===t?void 0:t.repos)||[],i={versions:ee(c),packages:ee(s)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(h,{activity:i}),r.a.createElement(F,null),r.a.createElement(X,null))}var ne=n(14),ae=n.n(ne),re=n(52),ce=n(26),se=n(190);function ie(e,t){return le.apply(this,arguments)}function le(){return(le=Object(ce.a)(ae.a.mark((function e(t,n){var a,r,c;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.ipfsApi,e.prev=1,r="".concat(a,"/api/v0/object/stat?arg=").concat(t.contentUri),e.next=5,Object(se.a)(r,{timeout:5e3}).json();case 5:return c=e.sent,e.abrupt("return",Boolean(c.CumulativeSize));case 9:return e.prev=9,e.t0=e.catch(1),console.log("Version ".concat(t.semanticVersion," ").concat(t.contentUri," not available: ").concat(e.t0.message)),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}var oe=n(192);n(418);function me(e){var t=e.ok,n=!0===t?"ok":!1===t?"nok":"";return r.a.createElement("span",{className:"status-bubble ".concat(n)},r.a.createElement(oe.a,null))}n(419);function ue(e){var t=e.url;return r.a.createElement("a",{className:"external-link",href:t,rel:"noopener noreferrer",target:"_blank"},r.a.createElement(w.a,null))}var de=n(193),pe=n.n(de);n(425);function ve(e){var t=e.address;return r.a.createElement("div",{className:"address-display"},t&&r.a.createElement("img",{className:"blockie",src:pe()(t),alt:""}),r.a.createElement("span",null,t?function(e){return"".concat(e.slice(0,6),"...").concat(e.slice(-4))}(t):""))}n(426);function fe(e){var t=e.version,n=e.isLatest,c=Object(a.useContext)(z).ipfsGateway,s=t.contentUri;return r.a.createElement("div",{className:"version-display"},r.a.createElement("div",{className:"header"},r.a.createElement("div",{className:"title"},t.semanticVersion," ",n?"(latest)":""),r.a.createElement("div",{className:"contentUri"},s)),r.a.createElement("iframe",{className:"content-preview",name:"version-content",id:"version-content",title:"version-content",src:J(c,s),frameBorder:0}))}n(427);var Ee=function(e){var t,n,c=e.match,s=Object(a.useState)({}),i=Object(B.a)(s,2),l=i[0],o=i[1],m=Object(a.useState)(!1),d=Object(B.a)(m,2),p=d[0],v=d[1],f=Object(u.e)(),E=Object(a.useContext)(z),h=E.ipfsGateway,g=E.ipfsApi,b=E.txViewer,y=c.params,N=y.repoId,x=y.versionId,k=(n={variables:{id:N}},A.c(T,n)),w=null===(t=k.data)||void 0===t?void 0:t.repo;if(Object(a.useEffect)((function(){function e(){return(e=Object(ce.a)(ae.a.mark((function e(){var t,n,a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!w||!w.versions){e.next=17;break}t=Object(Z.a)(w.versions),e.prev=2,a=ae.a.mark((function e(){var t,a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.value,e.next=3,ie(t,{ipfsApi:g});case 3:a=e.sent,o((function(e){return Object(j.a)({},e,Object(re.a)({},t.semanticVersion,a))}));case 5:case"end":return e.stop()}}),e)})),t.s();case 5:if((n=t.n()).done){e.next=9;break}return e.delegateYield(a(),"t0",7);case 7:e.next=5;break;case 9:e.next=14;break;case 11:e.prev=11,e.t1=e.catch(2),t.e(e.t1);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[2,11,14,17]])})))).apply(this,arguments)}p&&function(){e.apply(this,arguments)}()}),[g,w,p]),k.data&&w){var C,V=(w.versions||[]).sort((function(e,t){return t.index-e.index})).map((function(e){return Object(j.a)({},e,{semanticVersion:P(e.semanticVersion)})})),O=V[V.length-1];O.txHash&&w.txHash!==O.txHash&&V.push({semanticVersion:"Creation",index:-1,contentUri:"",timestamp:w.timestamp,txHash:w.txHash,sender:w.sender});var I=null===(C=w.lastVersion)||void 0===C?void 0:C.index,H=V.find((function(e){return e.semanticVersion===x}))||V[0]||void 0,R=H&&H.index===I;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement("div",{className:"repo-name"},G(w.name)),r.a.createElement("div",{className:"registry"},w.registryName)),H&&r.a.createElement(fe,{version:H,isLatest:R}),r.a.createElement("div",{className:"table-container"},r.a.createElement("table",{className:"summary-table"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Version"),r.a.createElement("th",null,"Age"),r.a.createElement("th",{onClick:function(){return v(!0)}},"Content"),r.a.createElement("th",null,"From"),r.a.createElement("th",null,"Txn"))),r.a.createElement("tbody",null,V.map((function(e){var t=e.semanticVersion,n=e.contentUri,a=e.timestamp,c=e.txHash,s=e.sender;return r.a.createElement("tr",{key:t,onClick:function(){return e=t,void f.push("/repo/".concat(N,"/").concat(e));var e}},r.a.createElement("td",null,t),r.a.createElement("td",null,r.a.createElement(_,{timestamp:a})),r.a.createElement("td",{className:"content"},p&&r.a.createElement(me,{ok:l[t]}),n&&r.a.createElement(ue,{url:J(h,n)})),r.a.createElement("td",null,r.a.createElement(ve,{address:s})),r.a.createElement("td",{className:"txn"},c&&r.a.createElement(ue,{url:K(b,c)})))}))))))}return k.error?r.a.createElement("div",null,k.error.message):k.loading?r.a.createElement("div",null,"Loading..."):null};function he(){return r.a.createElement("div",{className:"App"},r.a.createElement(d,null),r.a.createElement("div",{className:"app-body"},r.a.createElement(u.a,{path:"/",exact:!0,component:te}),r.a.createElement(u.a,{path:"/repo/:repoId/:versionId?",component:Ee})))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ge=new l.a({uri:"https://api.studio.thegraph.com/query/90626/dappnode-explorer/version/latest"});s.a.render(r.a.createElement(o.b,{client:ge},r.a.createElement(m.a,{client:ge},r.a.createElement(i.a,null,r.a.createElement(he,null)))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[223,1,2]]]);
//# sourceMappingURL=main.96ad0ea5.chunk.js.map